<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Arogyalloc AI ‚Äì Command Center</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Inter
        }

        body {
            background: radial-gradient(circle at top, #02121f, #01070f);
            color: white;
            min-height: 100vh;
            padding: 40px;
            transition: .4s;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(45deg, #00fff7, #00ffa2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav {
            display: flex;
            gap: 20px;
            align-items: center
        }

        .nav a {
            color: #38bdf8;
            text-decoration: none;
            font-weight: 600
        }

        button {
            padding: 10px 18px;
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
        }

        .logout {
            background: linear-gradient(45deg, #ef4444, #dc2626)
        }

        .ambulance {
            background: linear-gradient(45deg, #06b6d4, #22c55e)
        }

        .mode {
            background: linear-gradient(45deg, #6366f1, #9333ea)
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .card {
            background: rgba(15, 23, 42, .7);
            border-radius: 22px;
            padding: 25px;
            backdrop-filter: blur(18px);
            box-shadow: 0 0 40px rgba(0, 255, 255, .1);
            transition: .4s;
            cursor: pointer;
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 0 60px rgba(0, 255, 255, .25);
        }

        .label {
            font-size: 14px;
            opacity: .7
        }

        .value {
            font-size: 38px;
            font-weight: 700
        }

        .green {
            color: #22c55e
        }

        .yellow {
            color: #eab308
        }

        .red {
            color: #ef4444
        }

        .alert {
            margin-top: 30px;
            padding: 20px;
            border-radius: 18px;
            background: rgba(239, 68, 68, .1);
            border: 1px solid rgba(239, 68, 68, .3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 rgba(239, 68, 68, .4)
            }

            50% {
                box-shadow: 0 0 25px rgba(239, 68, 68, .6)
            }

            100% {
                box-shadow: 0 0 0 rgba(239, 68, 68, .4)
            }
        }

        canvas {
            background: #020617;
            border-radius: 16px;
            margin-top: 15px
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 22px;
            border-radius: 12px;
            font-weight: 600;
            color: white;
            box-shadow: 0 0 25px rgba(0, 0, 0, .4);
            animation: slide .4s ease;
        }

        @keyframes slide {
            from {
                transform: translateX(120%);
                opacity: 0
            }

            to {
                transform: translateX(0);
                opacity: 1
            }
        }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .7);
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modalBox {
            background: #020617;
            padding: 40px;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 300px;
        }

        .modalBox input,
        .modalBox select {
            padding: 14px;
            border: none;
            border-radius: 10px;
            background: #0f172a;
            color: white;
        }
    </style>
</head>

<body>

    <div class="header">
        <div class="logo">üß† Arogyalloc AI</div>

        <div class="nav">
            <a href="predictive.html">Predictive</a>
            <a href="simulator.html">Simulator</a>
            <a href="inventory.html">Inventory</a>
            <button class="mode" onclick="toggleMode()">üåì Mode</button>
            <button class="ambulance" onclick="openModal()">üöë Ambulance</button>
            <button class="logout" onclick="logout()">Logout</button>
        </div>
    </div>

    <!-- METRICS -->
    <div class="grid">
        <div class="card">
            <div class="label">Occupancy</div>
            <div id="occ" class="value">--</div>
        </div>
        <div class="card">
            <div class="label">Predicted Inflow</div>
            <div id="inf" class="value">--</div>
        </div>
        <div class="card">
            <div class="label">Resource Gap</div>
            <div id="gap" class="value">--</div>
        </div>
    </div>

    <!-- TOOLS -->
    <div class="grid">
        <div class="card" onclick="show('Beds available: 120')">üõè Beds Monitor</div>
        <div class="card" onclick="show('ICU Load: 68%')">ü©∫ ICU Status</div>
        <div class="card" onclick="show('Medicine stock stable')">üíâ Medicine Supply</div>
        <div class="card" onclick="show('Staff load moderate')">üë®‚Äç‚öï Staff Load</div>
        <div class="card" onclick="show('4 emergencies waiting')">üöë Emergency Queue</div>
        <div class="card" onclick="show('Supply trucks arriving')">üì¶ Supply Chain</div>
        <div class="card" onclick="show('Analytics synced')">üìä Analytics</div>
        <div class="card" onclick="show('Infection trend rising')">üß¨ Infection Trend</div>
        <div class="card" onclick="show('Sensors active')">üì° Live Sensors</div>
        <div class="card" onclick="downloadReport()">üìÅ Download Report</div>
    </div>

    <!-- MAP -->
    <div class="card">
        <h3>Live Facility Activity Map</h3>
        <canvas id="map" height="300"></canvas>
    </div>

    <!-- ACTIVITY -->
    <div class="card">
        <h3>System Activity</h3>
        <div id="activity"></div>
    </div>

    <div id="alertBox" class="alert" style="display:none">
        ‚ö† Critical shortage predicted ‚Äî action required.
    </div>

    <!-- MODAL -->
    <div id="modal" class="modal">
        <div class="modalBox">
            <h3>Emergency Ambulance</h3>
            <input id="name" placeholder="Patient Name">
            <input id="email" placeholder="Email">
            <input id="phone" placeholder="Phone">
            <input id="location" placeholder="Location">
            <select id="priority">
                <option>Critical</option>
                <option>Moderate</option>
                <option>Stable</option>
            </select>
            <button class="ambulance" onclick="book()">Dispatch</button>
        </div>
    </div>

    <script>
        const API = "http://127.0.0.1:8000"

        /* LOAD */
        async function load() {
            let r = await fetch(API + "/dashboard")
            let d = await r.json()

            occ.innerText = d.occupancy
            inf.innerText = d.inflow
            gap.innerText = d.gap

            let val = parseInt(d.occupancy)
            occ.className = "value " + (val < 60 ? "green" : val < 90 ? "yellow" : "red")

            if (d.gap > 100) alertBox.style.display = "block"
        }
        load()

        /* BUTTON DATA */
        function show(msg) { toast(msg, "#06b6d4") }

        /* PDF REPORT */
        function downloadReport() {
            let text = `ARO GYALLOC AI REPORT
Occupancy: ${occ.innerText}
Inflow: ${inf.innerText}
Gap: ${gap.innerText}
Generated: ${new Date().toLocaleString()}`
            let blob = new Blob([text])
            let a = document.createElement("a")
            a.href = URL.createObjectURL(blob)
            a.download = "Hospital_Report.txt"
            a.click()
            toast("Report Downloaded", "#22c55e")
        }

        /* MODE */
        let dark = true
        function toggleMode() {
            dark = !dark
            document.body.style.background =
                dark ? "radial-gradient(circle at top,#02121f,#01070f)" : "#f1f5f9"
            document.body.style.color = dark ? "white" : "black"
        }

        /* LOGOUT */
        function logout() { location = "login.html" }

        /* MODAL */
        function openModal() { modal.style.display = "flex" }
        function closeModal() { modal.style.display = "none" }

        /* TOAST */
        function toast(msg, color = "#22c55e") {
            let t = document.createElement("div")
            t.className = "toast"
            t.style.background = color
            t.innerText = msg
            document.body.appendChild(t)
            setTimeout(() => t.remove(), 3500)
        }

        /* AMBULANCE */
        async function book() {
            await fetch(API + "/book-ambulance", {
                method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({
                    name: name.value, email: email.value, phone: phone.value, location: location.value, priority: priority.value
                })
            })
            toast("Ambulance dispatched", "#06b6d4")
            closeModal()
        }

        /* MAP */
        const ctx = map.getContext("2d")
        let zones = []
        for (let i = 0; i < 15; i++) {
            zones.push({ x: Math.random() * map.width, y: Math.random() * 300, r: Math.random() * 30 + 10, dx: (Math.random() - .5) * 2, dy: (Math.random() - .5) * 2 })
        }
        function draw() {
            ctx.clearRect(0, 0, map.width, 300)
            zones.forEach(z => {
                z.x += z.dx; z.y += z.dy
                if (z.x < 0 || z.x > map.width) z.dx *= -1
                if (z.y < 0 || z.y > 300) z.dy *= -1
                let c = z.r > 30 ? "#ef4444" : z.r > 20 ? "#eab308" : "#22c55e"
                ctx.beginPath(); ctx.arc(z.x, z.y, z.r, 0, 6.28); ctx.fillStyle = c; ctx.fill()
            })
            requestAnimationFrame(draw)
        }
        draw()

        /* ACTIVITY */
        setInterval(() => {
            let t = new Date().toLocaleTimeString()
            activity.innerHTML = `<div>‚úî System check ${t}</div>` + activity.innerHTML
        }, 5000)

        /* ALERT */
        setInterval(async () => {
            let r = await fetch(API + "/dashboard")
            let d = await r.json()
            if (parseInt(d.occupancy) > 90) toast("Critical occupancy detected", "#ef4444")
        }, 8000)
    </script>
</body>

</html>